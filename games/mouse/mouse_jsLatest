// mouse.js
document.addEventListener("DOMContentLoaded", () => {
  const questionContainer = document.getElementById("question-container");
  const feedback = document.getElementById("feedback");
  const nextButton = document.getElementById("next-btn");

  // Read URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const topicName = urlParams.get("topic") || "Mouse Practice";
  const year = parseInt(urlParams.get("year")) || 1;

  // Progressive exercises per year
  const yearExercises = {
    1: [
      { type: "click", x: 100, y: 100, target: "ðŸ˜Š", description: "Click the smiling emoji ðŸ˜Š" },
      { type: "click", x: 300, y: 150, target: "â­", description: "Click the star â­" },
      { type: "click", x: 200, y: 250, target: "â¤ï¸", description: "Click the heart â¤ï¸" },
      { type: "click", x: 400, y: 300, target: "ðŸ˜Ž", description: "Click the cool emoji ðŸ˜Ž" },
      { type: "click", x: 150, y: 400, target: "ðŸ‘", description: "Click the thumbs up ðŸ‘" }
    ],
    2: [
      { type: "click", x: 120, y: 120, target: "ðŸ”¥", description: "Click the fire emoji ðŸ”¥" },
      { type: "click", x: 350, y: 150, target: "ðŸŽ", description: "Click the apple ðŸŽ" },
      { type: "click", x: 200, y: 300, target: "âš¡", description: "Click the lightning âš¡" },
      { type: "click", x: 400, y: 250, target: "ðŸŽµ", description: "Click the music ðŸŽµ" },
      { type: "click", x: 150, y: 420, target: "ðŸŒŸ", description: "Click the glowing star ðŸŒŸ" }
    ],
    3: [
      { type: "double", x: 100, y: 100, target: "ðŸ“", description: "Double-click the folder ðŸ“" },
      { type: "double", x: 300, y: 150, target: "ðŸ“‚", description: "Double-click the open folder ðŸ“‚" },
      { type: "double", x: 200, y: 250, target: "ðŸ“„", description: "Double-click the document ðŸ“„" },
      { type: "double", x: 400, y: 300, target: "ðŸ“", description: "Double-click the notepad ðŸ“" },
      { type: "double", x: 150, y: 400, target: "â­", description: "Double-click the star â­" }
    ],
    4: [
      { type: "drag", x: 100, y: 100, target: "â­", description: "Drag the star â­ into the box" },
      { type: "drag", x: 300, y: 150, target: "âšª", description: "Drag the circle âšª into the target area" },
      { type: "drag", x: 200, y: 250, target: "â¤ï¸", description: "Drag the heart â¤ï¸ into the box" },
      { type: "drag", x: 400, y: 300, target: "ðŸ˜Ž", description: "Drag the cool emoji ðŸ˜Ž to the box" },
      { type: "drag", x: 150, y: 400, target: "ðŸ‘", description: "Drag the thumbs up ðŸ‘ into the target" }
    ],
    5: [
      { type: "drag", x: 150, y: 100, target: "ðŸŽ", description: "Drag the apple ðŸŽ to the basket" },
      { type: "drag", x: 350, y: 200, target: "ðŸŒ", description: "Drag the banana ðŸŒ to the basket" },
      { type: "drag", x: 200, y: 250, target: "ðŸ’", description: "Drag the cherry ðŸ’ to the basket" },
      { type: "drag", x: 400, y: 300, target: "ðŸ‡", description: "Drag the grapes ðŸ‡ to the basket" },
      { type: "drag", x: 100, y: 400, target: "ðŸ‰", description: "Drag the watermelon ðŸ‰ to the basket" }
    ],
    6: [
      { type: "right", x: 150, y: 150, target: "ðŸ“", description: "Right-click the folder ðŸ“ to open menu" },
      { type: "right", x: 300, y: 200, target: "â­", description: "Right-click the star â­ to open menu" },
      { type: "right", x: 200, y: 300, target: "ðŸ“", description: "Right-click the notepad ðŸ“ to open menu" },
      { type: "right", x: 400, y: 250, target: "ðŸ“„", description: "Right-click the document ðŸ“„ to open menu" },
      { type: "right", x: 100, y: 400, target: "â¤ï¸", description: "Right-click the heart â¤ï¸ to open menu" }
    ],
    // Years 7â€“12 progressively combine double, right, drag and click with desktop workflow
    7: [
      { type: "double", x: 150, y: 150, target: "ðŸ“", description: "Double-click the folder ðŸ“ to open" },
      { type: "drag", x: 300, y: 200, target: "â­", description: "Drag the star â­ to the target" },
      { type: "right", x: 200, y: 300, target: "ðŸ“", description: "Right-click the notepad ðŸ“" }
    ],
    8: [
      { type: "double", x: 100, y: 100, target: "ðŸ“‚", description: "Double-click the open folder ðŸ“‚" },
      { type: "drag", x: 350, y: 200, target: "ðŸ“„", description: "Drag the document ðŸ“„ to folder" },
      { type: "right", x: 200, y: 250, target: "ðŸ“", description: "Right-click the notepad ðŸ“" }
    ],
    9: [
      { type: "double", x: 150, y: 150, target: "ðŸ“", description: "Double-click the folder ðŸ“" },
      { type: "drag", x: 300, y: 200, target: "â­", description: "Drag the star â­ to target" },
      { type: "right", x: 200, y: 300, target: "ðŸ“", description: "Right-click the notepad ðŸ“" }
    ],
    10: [
      { type: "drag", x: 100, y: 100, target: "ðŸ“", description: "Create a new folder: drag ðŸ“ to desktop" },
      { type: "drag", x: 350, y: 200, target: "ðŸ“‚", description: "Add subfolder: drag ðŸ“‚ into parent" }
    ],
    11: [
      { type: "drag", x: 200, y: 100, target: "ðŸ“", description: "Move folder ðŸ“ to correct location" },
      { type: "right", x: 300, y: 200, target: "ðŸ“‚", description: "Right-click subfolder ðŸ“‚" }
    ],
    12: [
      { type: "drag", x: 150, y: 150, target: "ðŸ“", description: "Final project: create folder, add subfolders, rename, delete" }
    ]
  };

  let exercises = yearExercises[year] || [];
  let currentExerciseIndex = 0;

  function showExercise() {
    feedback.textContent = "";
    nextButton.classList.add("hidden");

    if (currentExerciseIndex >= exercises.length) {
      questionContainer.innerHTML = `
        <h2>ðŸŽ‰ Congratulations! You completed Year ${year} "${topicName}" practice.</h2>
        <div class="flex gap-3 mt-4">
          <button id="restart-btn" style="padding:10px 15px;border-radius:8px;background:#4b3f72;color:#fff;cursor:pointer;">Restart</button>
          <button id="back-btn" style="padding:10px 15px;border-radius:8px;background:#555;color:#fff;cursor:pointer;">Back to Classes</button>
          <button id="home-btn" style="padding:10px 15px;border-radius:8px;background:#888;color:#fff;cursor:pointer;">Home</button>
        </div>
      `;

      document.getElementById("restart-btn").onclick = () => {
        currentExerciseIndex = 0;
        showExercise();
      };
      document.getElementById("back-btn").onclick = () => {
        window.location.href = "https://slide-t.github.io/smart-learningkids/classes.html";
      };
      document.getElementById("home-btn").onclick = () => {
        window.location.href = "https://slide-t.github.io/smart-learningkids/index.html";
      };
      return;
    }

    const exercise = exercises[currentExerciseIndex];

    questionContainer.innerHTML = `
      <h2>Year ${year} ${topicName} Exercise ${currentExerciseIndex + 1}/${exercises.length}</h2>
      <p>${exercise.description}</p>
      <div style="width:100%;height:400px;position:relative;border:2px dashed #ccc;margin-top:20px;" id="exercise-area">
        <button id="target-btn" style="
          position:absolute;
          top:${exercise.y}px;
          left:${exercise.x}px;
          padding:10px 15px;
          border-radius:8px;
          cursor:pointer;
        ">${exercise.target}</button>
      </div>
    `;

    const targetBtn = document.getElementById("target-btn");

    const handleEvent = (e) => {
      e.preventDefault();
      if (
        (exercise.type === "click" && e.type === "click") ||
        (exercise.type === "double" && e.type === "dblclick") ||
        (exercise.type === "right" && e.type === "contextmenu")
      ) {
        feedback.textContent = "âœ… Correct!";
        feedback.style.color = "green";
        currentExerciseIndex++;
        setTimeout(showExercise, 800);
      } else {
        feedback.textContent = "âŒ Wrong! Try again.";
        feedback.style.color = "red";
      }
    };

    if (exercise.type === "click") targetBtn.addEventListener("click", handleEvent);
    if (exercise.type === "double") targetBtn.addEventListener("dblclick", handleEvent);
    if (exercise.type === "right") targetBtn.addEventListener("contextmenu", handleEvent);

    if (exercise.type === "drag") {
      targetBtn.setAttribute("draggable", true);
      const exerciseArea = document.getElementById("exercise-area");
      const dropZone = document.createElement("div");
      dropZone.style = `
        position:absolute;
        width:100px;
        height:100px;
        border:2px dashed green;
        top:${exercise.y + 50}px;
        left:${exercise.x + 50}px;
      `;
      exerciseArea.appendChild(dropZone);

      targetBtn.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/plain", "drag");
      });

      dropZone.addEventListener("dragover", (e) => e.preventDefault());
      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        feedback.textContent = "âœ… Correct Drag!";
        feedback.style.color = "green";
        currentExerciseIndex++;
        setTimeout(showExercise, 800);
      });
    }
  }

  showExercise();
});
